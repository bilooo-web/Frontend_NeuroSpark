{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../../src/utils/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { Howl } from \"howler\";\nimport { BehaviorSubject, Subject } from \"rxjs\";\nimport { Alignment, Page, UserPreferences, RASMeta, RASDoc } from \"../index.d\";\n\nexport const USER_PREFERENCE_STORAGE_ID = \"RAUserPreferences\";\n\nexport const USER_PREFERENCE_VERSION = \"0.1\";\n/**\n * Return a zipped array of arrays\n * @param {array[]} arrays\n */\nexport function zip(arrays): Array<any[]> {\n  return arrays[0].map(function (_, i) {\n    return arrays.map(function (array) {\n      return array[i];\n    });\n  });\n}\n\nexport function isIOS(): boolean {\n  return /iPad|iPhone|iPod/.test(navigator.userAgent);\n}\n\n/**\n * Return pages from readalong XML file\n * @param {string} - the path to the readalong file\n */\nexport async function parseRAS(path: string): Promise<RASDoc> {\n  let response = await fetch(path);\n  if (!response.ok) {\n    console.error(`fetch(${path}) failed with status ${response.status}`);\n    return { pages: null, meta: null };\n  }\n  let xmlDocument = await response.text();\n  let parser = new DOMParser();\n  let xml = parser.parseFromString(xmlDocument, \"text/xml\");\n  return { pages: extractPages(xml), meta: extractMeta(xml) };\n}\n\n/**\n * Return pages from parsed XML\n * @param {xml} - the parsed XML (could be an element)\n */\nexport function extractPages(xml: Document | Element): Array<Page> {\n  let parsed_pages = Array.from(xml.querySelectorAll(\"div[type=page]\")).map(\n    (page) => {\n      let img = page.querySelector(\"graphic[url]\");\n      let paragraphs = page.querySelectorAll(\"p\");\n      let parsed_page = {\n        id: page.getAttribute(\"id\"),\n        paragraphs: Array.from(paragraphs),\n      };\n      if (img !== null) {\n        parsed_page[\"img\"] = img.getAttribute(\"url\");\n      }\n      if (page.attributes) parsed_page[\"attributes\"] = page.attributes;\n      return parsed_page;\n    },\n  );\n  return parsed_pages;\n}\n\n/**\n *\n * @param {xml} - the parsed XML\n * @returns {RASMeta} - meta key-values\n */\nexport function extractMeta(xml: Document | Element): RASMeta {\n  let meta = {};\n  Array.from(xml.querySelectorAll(\"meta\")).forEach((metaTag) => {\n    const key = metaTag.getAttribute(\"name\");\n    let value = metaTag.getAttribute(\"content\");\n    meta[key] = value.trim();\n  });\n  return meta;\n}\n\n/**\n * Extract alignment data from parsed text\n */\nexport function extractAlignment(parsed_text: Array<Page>): Alignment {\n  let alignment = {};\n  for (const page of parsed_text) {\n    for (const p of page.paragraphs) {\n      for (const w of Array.from(p.querySelectorAll(\"w[time][dur]\"))) {\n        const time = w.getAttribute(\"time\");\n        const dur = w.getAttribute(\"dur\");\n        if (time !== null && dur !== null)\n          alignment[w.getAttribute(\"id\")] = [\n            Math.round(parseFloat(time) * 1000),\n            Math.round(parseFloat(dur) * 1000),\n          ];\n      }\n    }\n  }\n  return alignment;\n}\n\n/**\n * Sprite class containing the state of our sprites to play and their progress.\n * @param {Object} options Settings to pass into and setup the sound and visuals.\n */\nexport var Sprite = function (options) {\n  var self = this;\n  const html5 = isIOS();\n  self.sounds = [];\n  // Setup the options to define this sprite display.\n  self._sprite = options.sprite;\n  // Create new Subject tracking which element is being read\n  self._reading$ = new Subject();\n  // List of all non-\"all\" sprites\n  self._tinySprite = Object.keys(options.sprite).map((str) => [\n    self._sprite[str][0],\n    str,\n    self._sprite[str][0] + self._sprite[str][1], //start time + duration (real time upper limit of the sprite)\n  ]);\n  // remove the 'all' sprite\n  self._tinySprite.pop();\n  // percentage finished\n  self._percentPlayed = new BehaviorSubject<string>(\"0%\");\n\n  // Create our audio sprite definition.\n  self.sound = new Howl({\n    src: options.src,\n    sprite: options.sprite,\n    rate: options.rate,\n    html5: html5,\n    onend: function () {\n      self._reading$.next(\"\"); //flush the pipe\n    },\n  });\n\n  // Begin the progress step tick.\n  requestAnimationFrame(self.step.bind(self));\n};\n\nSprite.prototype = {\n  /**\n   * Play a sprite when clicked and track the progress.\n   * @param  {String} key Key in the sprite map object.\n   */\n  play: function (key: string): number {\n    var self = this;\n    self._spriteLeft = self._tinySprite;\n    var sprite = key;\n    // Play the sprite sound and capture the ID.\n    var id = self.sound.play(sprite);\n    return id;\n  },\n\n  pause: function (): number {\n    var self = this;\n    self.sound.pause();\n    return self.sound.id;\n  },\n\n  /**\n   * Go back s seconds, or if current position - s is less than 0\n   * go back to the beginning.\n   *\n   * @param id - the id of the audio to roll back\n   * @param s - the number of seconds to go back\n   */\n  goBack: function (id: number, s: number): number {\n    var self = this;\n    // reset sprites left\n    self._spriteLeft = self._tinySprite;\n    // if current_seek - s is greater than 0, find the closest sprite\n    // and highlight it; seek to current_seek -s.\n    if (self.sound.seek((id = id)) - s > 0) {\n      var id: number = self.sound.seek(self.sound.seek((id = id)) - s, id);\n      // move highlight back TODO: refactor out into its own function and combine with version in step()\n      var seek = self.sound.seek((id = id));\n      for (var j = 0; j < self._spriteLeft.length; j++) {\n        // if seek passes sprite start point, replace self._reading with that sprite and slice the array of sprites left\n        if (seek * 1000 >= self._spriteLeft[j][0]) {\n          // only emit sprite if within current audio seek position\n          if (seek * 1000 <= self._spriteLeft[j][2]) {\n            self._reading$.next(self._spriteLeft[j][1]);\n          }\n          self._spriteLeft = self._spriteLeft.slice(j, self._spriteLeft.length);\n        }\n      }\n      self._reading$.next(self._spriteLeft[0][1]);\n      // else, return back to beginning\n    } else {\n      var id: number = self.sound.seek(0, id);\n      self._reading$.next(self._spriteLeft[0][1]);\n    }\n    return id;\n  },\n\n  /**\n   * Go to s seconds in the audio timeline\n   * @param id - the id of the audio to roll back\n   * @param s - the number of seconds to go back\n   */\n  goTo: function (id: number, s: number): number {\n    var self = this;\n    // reset sprites left\n    self._spriteLeft = self._tinySprite;\n    // if current_seek - s is greater than 0, find the closest sprite\n    // and highlight it; seek to current_seek -s.\n\n    var id: number = self.sound.seek(s, id);\n    // get the current audio position and convert it from seconds to millisecond\n    var seek = self.sound.seek((id = id)) * 1000;\n    for (var j = 0; j < self._spriteLeft.length; j++) {\n      // if seek passes sprite start point, replace self._reading with that sprite and slice the array of sprites left\n      if (seek >= self._spriteLeft[j][0]) {\n        // only emit sprite if within current audio seek position\n        if (seek <= self._spriteLeft[j][2]) {\n          self._reading$.next(self._spriteLeft[j][1]);\n          //attempt to adjust the audio position\n          id = self.sound.seek(self._spriteLeft[j][0], id); //set sound to beginning of word\n          self.sound.seek((id = id));\n          self._spriteLeft = self._spriteLeft.slice(j, self._spriteLeft.length);\n          break;\n        }\n      }\n    }\n    //update the progress bar\n    if (self.sounds.length) {\n      const percentage =\n        (Math.round((s / self.sound.duration(id)) * 100) || 0) + \"%\";\n\n      self.sounds[0].style.width = percentage;\n      self.sounds[0].setAttribute(\"offset\", percentage);\n    }\n\n    // else, return back to beginning\n    return id;\n  },\n\n  /**\n   * Stop the sound\n   */\n  stop: function (): number {\n    var self = this;\n    // remove reading\n    self._reading$.next(\"\");\n    // Play the sprite sound and capture the ID.\n    var id = self.sound.stop();\n    return id;\n  },\n\n  /**\n   * The step called within requestAnimationFrame to update the playback positions.\n   */\n  step: function (): void {\n    var self = this;\n    // // Loop through all active sounds and update their progress bar.\n    for (var i = 0; i < self.sounds.length; i++) {\n      var seek = self.sound.seek() || 0;\n      for (var j = 0; j < self._spriteLeft.length; j++) {\n        // TODO: refactor out into its own function and combine with version in step()\n        // if stopped\n        if (seek > 0) {\n          // if seek passes sprite start point, replace self._reading with that sprite and slice the array of sprites left\n          if (seek * 1000 >= self._spriteLeft[j][0]) {\n            // only emit sprite if within current audio seek position\n            if (seek * 1000 <= self._spriteLeft[j][2]) {\n              self._reading$.next(self._spriteLeft[j][1]);\n            }\n            self._spriteLeft = self._spriteLeft.slice(\n              j,\n              self._spriteLeft.length,\n            );\n          }\n        }\n      }\n      let percent = ((seek / self.sound.duration()) * 100 || 0) + \"%\";\n      self.sounds[i].style.width = percent;\n      self.sounds[i].setAttribute(\"offset\", percent);\n    }\n    requestAnimationFrame(self.step.bind(self));\n  },\n};\n\nexport async function isFileAvailable(url) {\n  return new Promise(function (resolve, _) {\n    let xhr = new XMLHttpRequest();\n    xhr.open(\"HEAD\", url);\n    xhr.onload = function () {\n      if (this.status >= 200 && this.status < 300) {\n        resolve(true);\n      } else {\n        resolve(false);\n      }\n    };\n    xhr.onerror = function () {\n      resolve(false);\n    };\n    xhr.send();\n  });\n}\n// returns users preference if it matches current version format\nexport const getUserPreferences = (): UserPreferences | null => {\n  const prefs: string = window.localStorage.getItem(USER_PREFERENCE_STORAGE_ID);\n  if (prefs && prefs.length) {\n    const user_preferences: UserPreferences = JSON.parse(prefs);\n    if (\n      user_preferences.version &&\n      user_preferences.version === USER_PREFERENCE_VERSION\n    ) {\n      return user_preferences;\n    }\n  }\n  return null;\n};\nexport const setUserPreferences = (userPref: UserPreferences) => {\n  window.localStorage.setItem(\n    USER_PREFERENCE_STORAGE_ID,\n    JSON.stringify(userPref),\n  );\n};\n\nexport const hasUserPreferences = (): boolean => {\n  return window.localStorage.getItem(USER_PREFERENCE_STORAGE_ID) !== null;\n};\n\nexport const clearUserPreferences = () => {\n  window.localStorage.removeItem(USER_PREFERENCE_STORAGE_ID);\n};\n\nexport const sentenceIsAligned = (sentence: Element): boolean => {\n  return sentence.innerHTML.includes(\"</w>\");\n};\n"]}